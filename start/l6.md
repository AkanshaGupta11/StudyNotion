//payment integrate 
//documentation se aati hain 

RAZOR PAY KI DOCUMENTATION 
jb bhi mai koi product buy krna hain --> un need to use order Api 
//course k order create krna pdega 
>>razorpay package -> instance -> orders.create 

*AMOUNT --> jho bhi amount bhejo vho actual amt * 100 hona chahiye like 300 => 30,000 -> tbhi 300.00
*CUrrency \

/// COURSE KO TREAT AS ORDER
ORDER CREATE KRNA PDEGA 
RAZOR PAY K INSTANCE LO -> USMAI ORDERS.CREATE LGAO 
HRR BAAR ODER GENERATE KRUNGA -> order id generate hoga 

refund -> order id se search krta 
ORDER  REATE KIYE --> 3 STAGE -
//////////////////CREATED , ATTEMPTED , PAID 
Verify payment signature ===> 

CREATE ------------------------------>ATTEMPT -> PAID

STATUS 
CREATED -----> Authorized ---> Captured
|                   |               |
failed           Refunded------------


CAPTURE AND REFUND SETTING 
web dev -> buy now -> created 
payement kr rhe -> attempted 
pay success -> captured 

buy now oai click ho 



PAYEMENT INTEGRATION -> 2 STEP PROCESS
1> CAPTURE PAYment -> pay initiate / order create
courseId , userId 
validation -> chk user id , course id 
chk if user has already not bought that course 

pay krne k baad ab BANK OR RAZOR PAY INTEGRATE KRRA

HUMME BSS CAPTURE KRNA 

aapne pay ment kiye -> interaction btw razor pay and bank --> = mereko kaise pta lge ga ki payment aagyi  hain  --> kisi prakaar i verification krni pdegi --> webHook -> kind of notification -> notififcation setup 
jaise hi payement aagyi --> successfully pay --> razor pay mai web hook set up kiya 
-> successful transaction --> API ROUTE KO hit kr dena 
secret key -> verify signature 

CaPTURE 
order create (price, order)
UI MAI modal dikh rha --> scanner , emi , debit card , credit card 
payment krdi bank se razor pay mai paise bhej diye -> successfull
successful hogya -> web hook ko activate kr diye -> verfiy signature api route ko hit kr denge 
logic razor pay seceret key bheh ( ek secret key razor pay bheje ga , or ek hogi )
secret key match -> authorize 


paynow -- >> order create ---> orer kuch bhi ho skta -> capture , fail hojaayeg -> y meri tension nhi 

mera kaam ordr create krne k tha 
razor pay k modal 
qr code dikh rha--> scan pay 
bank ne transfer to code hlep 
seccess transact --> web hook set up kiya rakha hain -> kisi particular event hin epai ye api hit kr dena 
web hook activate 
-> api route add kra tha --> verify signature ko hit kiya --> sath mai signature pass kr 
verifysign -> andr secret key hian 
//agr value match -> authorisse 




PAYMENT CONTROLLER ..................................

NPM I razorpay
instance of razorpay 
config k aandr 

courseid , userid 
course detail
uid 

verifySignature 
--> razorpay -> hash kr ke bheja hoga hain 
webhooksecret -> step se guzaar do -> match kro 



HASHING FUNCTION ====>
example k lliyeeeeeee
hf(123) -> 1+2+3 -> 6th character -> ans -> f
hf(126) => ans -> e

sha ->>. DATA KO ENCRYPT FORM MAI CONVERT KR SKTE HO 
hmac --> combination hota hain 
->hashing algo -> kis algo k use 
->secret key -> kis secret key k aadhar pr 
hmac work on top of hashing algo 

DONO K SAME KAAM -- message ki authenticity , integrity check krna 
client n message bhej or ab mai check krunga ky mera mess intact hain , y authentic hain , jho bheja vhi mssg aaya hain ki nhi 

CHECKSUM -----

DIGEST ---> jb bhi koi hashing algo run krte koi text k upper jho otput aata usko bht saare special terms se represent krte usse kehte han -> digest 

generally in hexadecimal format 

order create --> payment authorise ho gyi --> ab kuch action hoga 
action -> bachee ko course me enroll krao 

user -> course mai -> object id store kro 
course->student enrolled -> object id 

razor pay ne request kiya --> /verifySignature -> req.body.payload.entity.notes


order initiate 
kis student , kis course 
validation course id , course detail , user has not alresdy bought the course 

order create --> instance create -> 

verify signature 
server k pass web hook k secret 
razor pay k pass secret enter kiya th 
aapne signature --> ko encrypt kiya 
compare kiya -> match -> payment authorize --> enroll in course -> successfull mail 


course controller -> get handler -> get course detail 
rating n review -> create rating 
--> get average rating 
--> get all rating 



CAPTURE PYMENT 
1> Fetch user id , course id , -> konse user n liya hian or konsa course liya hian 
2>validate -> user id , course id exists or not 
3> fetcch course detail -> course detail exist or not 
4> if user has already bought course -> how eill know -> course-> studentEnrolled-> userid would be present 

options mai amoun , currency , receipt , notes 
5>Create instance.orders.create (options )
return response coursename , desc , thimbnail , objid ,amount , currency 

AB VERIFICATION 
DONO SECRETS KO MATCH KRANHIA 
>>webhook 
>>secret = req.headers["x-razorpay-signature]
shaasum = hmmac
convert to string 
digest 
match 
if match , add ids in course of user and student enrlled 
Course.findByIdndUodate(
    {_id:id},{
        $push:{
            studentEnrolled:user_id
        }
    }
)